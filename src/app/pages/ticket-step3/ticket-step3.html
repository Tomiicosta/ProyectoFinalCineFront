<main>
    <section class="ticket-info font-open-sans">
        <h1 class="info"><span class="color">SELECCIONE</span> SUS <span class="color">BUTACAS</span></h1>
        <h1 class="step">PASO <span class="step-num">3</span></h1>
    </section>

    <section class="ticket-section font-inter">
        <!-- Panel de Información (INFO PELICULA) -->
        @if (peliculaSeleccionada && funcionSeleccionada) {
        <div class="div-info">
            <h4 class="info-title">Detalles del Ticket</h4>

            <!-- Información Fija (Película, Día, Hora) -->
            <div class="info-peli">
                <h3 class="title-peli" title="{{ peliculaSeleccionada.title }}">
                    {{ peliculaSeleccionada.title }}
                </h3>
                <p class="funcion-peli"><b>{{ formatearFecha(funcionSeleccionada.date) }}</b></p>
                <p class="funcion-peli">a las <b>{{ formatearHora(funcionSeleccionada.time) }} hs</b></p>
            </div>

            <!-- Asientos Seleccionados (Reactivo) -->
            <div class="div-butacas">
                <h3 class="cinema-funcion">{{ funcionSeleccionada.cinemaName }}</h3>
                <p class="title-butacas">
                    <b>Asientos Seleccionados:</b>
                </p>
                <p class="num-butacas"><b>{{ totalButacasSeleccionadas() }}</b></p>

                <h3 class="subtitle-butacas">
                    Butacas:
                </h3>
                <p class="list-butacas">
                    <b>
                        {{ listaButacasSeleccionadas() || 'Ninguna' }}
                    </b>
                </p>
            </div>

            <ul class="info-colores">
                <li class="info-color">
                    <div class="color c-1"></div>
                    <p>Butaca Disponible</p>
                </li>
                <li class="info-color">
                    <div class="color c-2"></div>
                    <p>Butaca Seleccionada</p>
                </li>
                <li class="info-color">
                    <div class="color c-3"></div>
                    <p>Butaca Ocupada</p>
                </li>
            </ul>

            <button class="btn-reiniciar" (click)="limpiarButacasSeleccionadas()"
                [disabled]="totalButacasSeleccionadas() === 0">
                Reiniciar Butacas
            </button>
        </div>
        }

        <!-- Mapa de la Sala -->
        <div class="div-sala">
            <div class="div-pantalla">
                <h2 class="title-pantalla font-open-sans">PANTALLA</h2>
                <div class="pantalla"></div>
            </div>
            <div class="div-butacas">

                @for (fila of mapaButacas(); track $index) {
                <div class="fila-butacas">

                    <!-- Etiqueta de fila -->
                    <span class="etiqueta-fila">
                        {{ getFilaLetra(fila[0]?.seatRowNumber) }}
                    </span>

                    <!-- Iterar cada butaca dentro de la fila -->
                    @for (butaca of fila; track butaca?.id) {
                    <div class="butaca" (click)="seleccionarButaca(butaca)" [ngClass]="{
                            'ocupada': butaca?.occupied,
                            'seleccionada': isButacaSeleccionada(butaca),
                            'disponible': !butaca?.occupied && !isButacaSeleccionada(butaca)
                        }">
                    </div>
                    }
                </div>
                }

            </div>

        </div>
    </section>

    <aside class="banner">
        <div class="btns-ticket font-inter">
            <button id="btn-step" class="" (click)="confirmarPaso3()">SIGUIENTE</button>
            <button id="btn-back" class="" (click)="volverAtras()">ATRÁS</button>

            <!-- DIV DE ERRORES -->
            @if (errorMessage()) {
            <div class="div-error ">
                {{ errorMessage() }}
            </div>
            }
        </div>

    </aside>

    <!-- MODAL DE LOGIN REQUERIDO -->
    @if (mostrarModalLogin) {
        <div class="modal-backdrop">
            <div class="modal-box font-inter">

                <h2 class="modal-title">Inicia sesión</h2>
                <p class="modal-text">
                    Debes haber iniciado sesión primero para continuar con el proceso de compra.
                </p>

                <button class="btn-login" (click)="redirigirLogin()" [disabled]="cargandoRedireccionLogin">

                    @if (!cargandoRedireccionLogin) {
                        Iniciar Sesión
                    } @else {
                        <span class="spinner"></span> Redireccionando...
                    }
                </button>

                <button class="btn-login" (click)="redirigirRegister()" [disabled]="cargandoRedireccionRegister">

                    @if (!cargandoRedireccionRegister) {
                        Registrarme
                    } @else {
                        <span class="spinner"></span> Redireccionando...
                    }
                </button>

            </div>
        </div>
    }

</main>